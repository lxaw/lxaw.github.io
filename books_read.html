<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reading List | Lex Whalen</title>
</head>
<body>
    <center>
        <h1>Reading List</h1>
        <p>Here's where I keep a list of books I have read. This list was curated by <a href="index.html">myself</a>, beginning from around February 2023 to now.</p>
        <p>I typically use this to organize books I found interesting. Please feel free to do whatever you want with it.</p>
        
        <br>
        
        <!-- Basic Search -->
        <p>Search: <input type="text" id="globalSearch" placeholder="Search books..." onkeyup="applyFilters()"></p>
        
        <br>
        
        <!-- Statistics -->
        <p id="bookCount">So far, we have read XXX books. Let's keep it up!</p> 
        <small id="searchCount">Your search returned YYY books. Nice!</small>
        
        <br>
        
        <!-- Individual Search Fields -->
        <div class="search-inputs">
            <input type="text" id="titleSearch" placeholder="Search title..." onkeyup="applyFilters()">
            <input type="text" id="authorSearch" placeholder="Search author..." onkeyup="applyFilters()">
            <input type="text" id="yearSearch" placeholder="Search year..." onkeyup="applyFilters()">
            <input type="text" id="descriptionSearch" placeholder="Search description..." onkeyup="applyFilters()">
            <button onclick="clearAllFilters()">Clear Search</button>
        </div>
        
        <br>
        
        <!-- Advanced Filters -->
        <div id="advancedFilters">
            <label>Min Pages: <input type="number" id="minPages" placeholder="Min" onchange="applyFilters()"></label>
            <label>Max Pages: <input type="number" id="maxPages" placeholder="Max" onchange="applyFilters()"></label>
            
            <label>Year From: <input type="number" id="yearFrom" placeholder="2023" min="2020" max="2025" onchange="applyFilters()"></label>
            <label>Year To: <input type="number" id="yearTo" placeholder="2024" min="2020" max="2025" onchange="applyFilters()"></label>
            
            <label><input type="checkbox" id="exactMatch" onchange="applyFilters()"> Exact Match</label>
            <label><input type="checkbox" id="caseSensitive" onchange="applyFilters()"> Case Sensitive</label>
        </div>
        
        <br>
        
        <table id="bookTable" border="1" cellpadding="5" cellspacing="0">
            <thead>
                <tr>
                    <th onclick="sortTable(0)">Title</th>
                    <th onclick="sortTable(1)">Author</th>
                    <th onclick="sortTable(2)">Date Complete</th>
                    <th onclick="sortTable(3)">Page Count</th>
                    <th onclick="sortTable(4)">Rating</th>
                    <th onclick="sortTable(5)">Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="6">Loading books...</td>
                </tr>
            </tbody>
        </table>
        
        <br>
        
        <p><a href="index.html">Back to home</a></p>
    </center>

    <script>
        let allBooks = [];
        let filteredBooks = [];
        let sortDirection = {};

        // Load books from JSON file
        fetch('books/list.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to load books');
                }
                return response.json();
            })
            .then(books => {
                allBooks = books;
                filteredBooks = [...allBooks];
                displayBooks(filteredBooks);
                updateCounts();
            })
            .catch(error => {
                console.error('Error loading books:', error);
                document.querySelector('#bookTable tbody').innerHTML = '<tr><td colspan="6">Error loading books. Please try again later.</td></tr>';
            });

        function displayBooks(books) {
            const tbody = document.querySelector('#bookTable tbody');
            tbody.innerHTML = '';
            
            if (books.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6">No books found.</td></tr>';
                return;
            }

            books.forEach(book => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${book.title || ''}</td>
                    <td>${book.author || ''}</td>
                    <td>${book['date-complete'] || ''}</td>
                    <td>${book['page-count'] || ''}</td>
                    <td>${book.rating || ''}</td>
                    <td>${book.description || ''}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function applyFilters() {
            const globalSearch = document.getElementById('globalSearch').value;
            const titleSearch = document.getElementById('titleSearch').value;
            const authorSearch = document.getElementById('authorSearch').value;
            const yearSearch = document.getElementById('yearSearch').value;
            const descriptionSearch = document.getElementById('descriptionSearch').value;
            const minPages = document.getElementById('minPages').value;
            const maxPages = document.getElementById('maxPages').value;
            const yearFrom = document.getElementById('yearFrom').value;
            const yearTo = document.getElementById('yearTo').value;
            const exactMatch = document.getElementById('exactMatch').checked;
            const caseSensitive = document.getElementById('caseSensitive').checked;

            filteredBooks = allBooks.filter(book => {
                // Helper function for text matching
                const matchText = (text, searchTerm) => {
                    if (!searchTerm) return true;
                    if (!text) return false;
                    
                    const textToSearch = caseSensitive ? text : text.toLowerCase();
                    const termToSearch = caseSensitive ? searchTerm : searchTerm.toLowerCase();
                    
                    return exactMatch ? textToSearch === termToSearch : textToSearch.includes(termToSearch);
                };

                // Global search across all fields
                if (globalSearch) {
                    const allText = Object.values(book).join(' ');
                    if (!matchText(allText, globalSearch)) return false;
                }

                // Individual field searches
                if (!matchText(book.title, titleSearch)) return false;
                if (!matchText(book.author, authorSearch)) return false;
                if (!matchText(book.description, descriptionSearch)) return false;

                // Year search in date field
                if (yearSearch) {
                    const dateText = book['date-complete'] || '';
                    if (!matchText(dateText, yearSearch)) return false;
                }

                // Page count filters
                if (minPages) {
                    const pageCount = book['page-count'] ? parseInt(book['page-count']) : 0;
                    if (pageCount < parseInt(minPages)) return false;
                }
                if (maxPages) {
                    const pageCount = book['page-count'] ? parseInt(book['page-count']) : 0;
                    if (pageCount > parseInt(maxPages)) return false;
                }

                // Year range filters
                if (yearFrom || yearTo) {
                    const bookYear = book['date-complete'] ? new Date(book['date-complete']).getFullYear() : 0;
                    if (yearFrom && bookYear < parseInt(yearFrom)) return false;
                    if (yearTo && bookYear > parseInt(yearTo)) return false;
                }

                return true;
            });

            displayBooks(filteredBooks);
            updateCounts();
        }

        function clearAllFilters() {
            document.getElementById('globalSearch').value = '';
            document.getElementById('titleSearch').value = '';
            document.getElementById('authorSearch').value = '';
            document.getElementById('yearSearch').value = '';
            document.getElementById('descriptionSearch').value = '';
            document.getElementById('ratingFilter').value = '';
            document.getElementById('minPages').value = '';
            document.getElementById('maxPages').value = '';
            document.getElementById('yearFrom').value = '';
            document.getElementById('yearTo').value = '';
            document.getElementById('exactMatch').checked = false;
            document.getElementById('caseSensitive').checked = false;
            
            filteredBooks = [...allBooks];
            displayBooks(filteredBooks);
            updateCounts();
        }

        function updateCounts() {
            const totalBooks = allBooks.length;
            const displayedBooks = filteredBooks.length;
            
            document.getElementById('bookCount').textContent = `So far, we have read ${totalBooks} books. Let's keep it up!`;
            
            if (displayedBooks === totalBooks) {
                document.getElementById('searchCount').textContent = '';
            } else {
                document.getElementById('searchCount').textContent = `Your search returned ${displayedBooks} books. Nice!`;
            }
        }

        function sortTable(columnIndex) {
            const table = document.getElementById('bookTable');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.rows);
            const isAsc = sortDirection[columnIndex] !== 'asc';
            sortDirection[columnIndex] = isAsc ? 'asc' : 'desc';

            const columnMap = ['title', 'author', 'date-complete', 'page-count', 'rating', 'description'];
            const sortKey = columnMap[columnIndex];

            filteredBooks.sort((a, b) => {
                let aValue = a[sortKey] || '';
                let bValue = b[sortKey] || '';
                
                // Handle numeric columns
                if (columnIndex === 3) { // Page count
                    aValue = parseInt(aValue) || 0;
                    bValue = parseInt(bValue) || 0;
                    return isAsc ? aValue - bValue : bValue - aValue;
                }
                
                // Handle date column
                if (columnIndex === 2) { // Date complete
                    aValue = new Date(aValue || 0);
                    bValue = new Date(bValue || 0);
                    return isAsc ? aValue - bValue : bValue - aValue;
                }
                
                // Handle rating column
                if (columnIndex === 4) { // Rating
                    aValue = aValue ? parseInt(aValue.split('/')[0]) : 0;
                    bValue = bValue ? parseInt(bValue.split('/')[0]) : 0;
                    return isAsc ? aValue - bValue : bValue - aValue;
                }
                
                // Handle text columns
                return isAsc ? 
                    aValue.toString().localeCompare(bValue.toString()) : 
                    bValue.toString().localeCompare(aValue.toString());
            });

            displayBooks(filteredBooks);
        }

        // Legacy function for backward compatibility
        function searchBooks() {
            applyFilters();
        }
    </script>
</body>
</html>