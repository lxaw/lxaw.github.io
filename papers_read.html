<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reading List | Lex Whalen</title>

</head>
<body>
    <center>
        <h1>Reading List</h1>
        <p>Here's where I keep a list of books I have read. This list was curated by <a href="index.html">myself</a>, beginning from around February 2023 to now.</p>
        <p>I typically use this to organize books I found interesting. Please feel free to do whatever you want with it.</p>
        
        <p id="bookCount">
            So far, we have read 0 books. Let's keep it up!
        </p>
        <small id="searchCount">
            Your search returned 0 books. Nice!
        </small>
        
        <p>
            Search title: <input type="text" id="titleSearch" placeholder="Search title...">
            Search author: <input type="text" id="authorSearch" placeholder="Search author...">
            Search date: <input type="text" id="dateSearch" placeholder="Search date...">
            Search rating: <input type="text" id="ratingSearch" placeholder="Search rating...">
            Search description: <input type="text" id="descriptionSearch" placeholder="Search description...">
            <button id="clearSearch">Clear Search</button>
        </p>
        
        <table id="bookTable" border="1" cellpadding="5" cellspacing="0">
            <thead>
                <tr>
                    <th onclick="sortTable(0)">Title</th>
                    <th onclick="sortTable(1)">Author</th>
                    <th onclick="sortTable(2)">Date Complete</th>
                    <th onclick="sortTable(3)">Page Count</th>
                    <th onclick="sortTable(4)">Rating</th>
                    <th onclick="sortTable(5)">Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="6">Loading books...</td>
                </tr>
            </tbody>
        </table>
        
        <br>
        
        <p><a href="index.html">Back to home</a></p>
    </center>

    <script>
        let allBooks = [];
        let filteredBooks = [];
        let sortDirection = {};

        // Load books from JSON file
        fetch('books/list.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to load books');
                }
                return response.json();
            })
            .then(books => {
                allBooks = books;
                filteredBooks = books;
                updateCounts();
                displayBooks(books);
            })
            .catch(error => {
                console.error('Error loading books:', error);
                document.querySelector('#bookTable tbody').innerHTML = '<tr><td colspan="6">Error loading books. Please try again later.</td></tr>';
            });

        function updateCounts() {
            document.getElementById('bookCount').textContent = `So far, we have read ${allBooks.length} books. Let's keep it up!`;
            document.getElementById('searchCount').textContent = `Your search returned ${filteredBooks.length} books. Nice!`;
        }

        function displayBooks(books) {
            const tbody = document.querySelector('#bookTable tbody');
            tbody.innerHTML = '';
            
            if (books.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6">No books found.</td></tr>';
                return;
            }

            books.forEach(book => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${book.title || ''}</td>
                    <td>${book.author || ''}</td>
                    <td>${book['date-complete'] || ''}</td>
                    <td>${book['page-count'] || ''}</td>
                    <td>${book.rating || ''}</td>
                    <td>${book.description || ''}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function performSearch() {
            const titleSearch = document.getElementById('titleSearch').value.toLowerCase();
            const authorSearch = document.getElementById('authorSearch').value.toLowerCase();
            const dateSearch = document.getElementById('dateSearch').value.toLowerCase();
            const ratingSearch = document.getElementById('ratingSearch').value.toLowerCase();
            const descriptionSearch = document.getElementById('descriptionSearch').value.toLowerCase();

            filteredBooks = allBooks.filter(book => {
                const titleMatch = !titleSearch || (book.title && book.title.toLowerCase().includes(titleSearch));
                const authorMatch = !authorSearch || (book.author && book.author.toLowerCase().includes(authorSearch));
                const dateMatch = !dateSearch || (book['date-complete'] && book['date-complete'].toLowerCase().includes(dateSearch));
                const ratingMatch = !ratingSearch || (book.rating && book.rating.toLowerCase().includes(ratingSearch));
                const descriptionMatch = !descriptionSearch || (book.description && book.description.toLowerCase().includes(descriptionSearch));
                
                return titleMatch && authorMatch && dateMatch && ratingMatch && descriptionMatch;
            });
            
            updateCounts();
            displayBooks(filteredBooks);
        }

        function clearSearch() {
            document.getElementById('titleSearch').value = '';
            document.getElementById('authorSearch').value = '';
            document.getElementById('dateSearch').value = '';
            document.getElementById('ratingSearch').value = '';
            document.getElementById('descriptionSearch').value = '';
            
            filteredBooks = allBooks;
            updateCounts();
            displayBooks(allBooks);
        }

        // Add event listeners for real-time search
        document.getElementById('titleSearch').addEventListener('input', performSearch);
        document.getElementById('authorSearch').addEventListener('input', performSearch);
        document.getElementById('dateSearch').addEventListener('input', performSearch);
        document.getElementById('ratingSearch').addEventListener('input', performSearch);
        document.getElementById('descriptionSearch').addEventListener('input', performSearch);
        document.getElementById('clearSearch').addEventListener('click', clearSearch);

        function sortTable(columnIndex) {
            const table = document.getElementById('bookTable');
            const rows = Array.from(table.rows).slice(1); // Skip header row
            const isAsc = sortDirection[columnIndex] !== 'asc';
            sortDirection[columnIndex] = isAsc ? 'asc' : 'desc';

            rows.sort((a, b) => {
                const aValue = a.cells[columnIndex].textContent;
                const bValue = b.cells[columnIndex].textContent;
                
                // Handle numeric columns
                if (columnIndex === 3) { // Page count
                    return isAsc ? Number(aValue) - Number(bValue) : Number(bValue) - Number(aValue);
                }
                
                // Handle date column
                if (columnIndex === 2) { // Date complete
                    return isAsc ? new Date(aValue) - new Date(bValue) : new Date(bValue) - new Date(aValue);
                }
                
                // Handle rating column
                if (columnIndex === 4) { // Rating
                    const aRating = Number(aValue.split('/')[0]) || 0;
                    const bRating = Number(bValue.split('/')[0]) || 0;
                    return isAsc ? aRating - bRating : bRating - aRating;
                }
                
                // Handle text columns
                return isAsc ? aValue.localeCompare(bValue) : bValue.localeCompare(aValue);
            });

            const tbody = table.querySelector('tbody');
            rows.forEach(row => tbody.appendChild(row));
        }
    </script>
</body>
</html>